<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A minimalistic task manager for today and tomorrow">
    <meta name="theme-color" content="#f6fafe" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0f1417" media="(prefers-color-scheme: dark)">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="It Can Wait">
    <link rel="manifest" href="/it-can-wait/manifest.json">
    <title>It Can Wait</title>
    <style>
        :root {
            --primary: #006491;
            --on-primary: #ffffff;
            --primary-container: #c7e7ff;
            --on-primary-container: #001e2e;
            --surface: #f6fafe;
            --surface-c: #eaeef3;
            --surface-ch: #e4e9ee;
            --surface-chh: #dee3e8;
            --on-surface: #171c1f;
            --on-surface-v: #41484d;
            --outline: #71787e;
            --outline-v: #c0c7cd;
            --error: #ba1a1a;
            --error-c: #ffdad6;
            --done: #1a6e37;
            --shadow: 0 1px 2px rgba(0,0,0,0.1), 0 1px 3px rgba(0,0,0,0.08);
        }

        [data-theme="dark"] {
            --primary: #80cfff;
            --on-primary: #00344d;
            --primary-container: #004c6e;
            --on-primary-container: #c7e7ff;
            --surface: #0f1417;
            --surface-c: #1b2024;
            --surface-ch: #252b2f;
            --surface-chh: #30363a;
            --on-surface: #dee3e8;
            --on-surface-v: #c0c7cd;
            --outline: #8a9297;
            --outline-v: #41484d;
            --error: #ffb4ab;
            --error-c: #93000a;
            --done: #7dd99b;
            --shadow: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.2);
        }

        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

        body {
            font-family: 'Google Sans', 'Roboto', system-ui, sans-serif;
            background: var(--surface);
            color: var(--on-surface);
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* â”€â”€ Layout â”€â”€ */
        .container {
            display: flex;
            height: 100vh;
            background: var(--outline-v);
        }

        .panel {
            flex: 1;
            background: var(--surface);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }

        .divider {
            background: var(--surface-c);
            display: flex;
            align-items: center;
            justify-content: center;
            align-self: stretch;
            flex-shrink: 0;
            position: relative;
        }

        .divider-text {
            font-family: 'Courier New', monospace;
            font-size: 10px;
            color: var(--outline);
            white-space: nowrap;
            letter-spacing: 0.4em;
            position: absolute;
        }

        /* â”€â”€ Header â”€â”€ */
        .header {
            padding: 20px 20px 14px;
            background: var(--surface-c);
        }

        .header h1 {
            font-size: 22px;
            font-weight: 400;
            text-align: center;
            letter-spacing: -0.01em;
        }

        .header .date {
            font-size: 12px;
            color: var(--on-surface-v);
            text-align: center;
            margin-top: 2px;
        }

        .progress-bar {
            margin-top: 12px;
            height: 3px;
            background: var(--outline-v);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--done);
            border-radius: 2px;
            transition: width 0.4s cubic-bezier(0.4,0,0.2,1);
        }

        .progress-text {
            font-size: 11px;
            color: var(--outline);
            margin-top: 5px;
            text-align: center;
        }

        /* â”€â”€ Entries â”€â”€ */
        .entries {
            flex: 1;
            overflow-y: auto;
            padding: 8px 12px 100px;
        }

        .entries::-webkit-scrollbar { width: 0; }

        .entry {
            background: var(--surface-c);
            border-radius: 16px;
            padding: 14px 12px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow);
            transition: all 0.2s cubic-bezier(0.4,0,0.2,1);
        }

        .entry:active { box-shadow: none; transform: scale(0.99); }
        .entry.completed { opacity: 0.5; }
        .entry.completed .entry-text { text-decoration: line-through; color: var(--outline); }
        .entry.dragging { opacity: 0.35; }

        .drag-handle {
            width: 18px; min-width: 18px; height: 20px;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            gap: 3px; cursor: grab; opacity: 0.3;
        }

        .drag-handle span {
            width: 14px; height: 2px;
            background: var(--on-surface-v);
            border-radius: 1px;
        }

        .checkbox {
            width: 22px; height: 22px; min-width: 22px;
            border: 2px solid var(--outline);
            border-radius: 6px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
        }

        .checkbox.checked { background: var(--done); border-color: var(--done); }
        .checkbox.checked::after { content: 'âœ“'; color: white; font-size: 13px; font-weight: bold; }

        .entry-content { flex: 1; min-width: 0; }

        .entry-text {
            font-size: 14px;
            word-break: break-word;
            line-height: 1.4;
        }

        .timestamp {
            font-size: 11px;
            color: var(--outline);
            margin-top: 2px;
        }

        .archive-tag {
            font-size: 10px;
            color: var(--outline);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-top: 2px;
        }

        .entry-actions { display: flex; gap: 6px; }

        .btn {
            padding: 7px 11px;
            background: var(--surface-ch);
            border: none; border-radius: 20px;
            color: var(--on-surface-v);
            cursor: pointer; font-size: 16px;
            line-height: 1; transition: all 0.15s;
        }

        .btn:active { background: var(--primary-container); color: var(--on-primary-container); transform: scale(0.92); }
        .btn.danger:active { background: var(--error-c); color: var(--error); }

        /* â”€â”€ FAB â”€â”€ */
        .fab-wrap {
            position: fixed;
            bottom: 28px; right: 28px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0;
        }

        .fab-dial {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
            margin-bottom: 16px;
            opacity: 0;
            pointer-events: none;
            transform: translateY(16px);
            transition: opacity 0.2s, transform 0.2s cubic-bezier(0.4,0,0.2,1);
        }

        .fab-dial.open {
            opacity: 1;
            pointer-events: all;
            transform: translateY(0);
        }

        .fab-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fab-label {
            background: var(--surface-chh);
            color: var(--on-surface);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            box-shadow: var(--shadow);
            white-space: nowrap;
        }

        .fab-mini {
            width: 48px; height: 48px;
            background: var(--surface-chh);
            color: var(--on-surface);
            border: none; border-radius: 14px;
            font-size: 20px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow);
            transition: all 0.15s;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .fab-mini:active { background: var(--primary-container); transform: scale(0.92); }

        .fab-mini input[type="color"] {
            opacity: 0;
            position: absolute;
            inset: 0;
            cursor: pointer;
            border: none;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        .fab-main {
            width: 64px; height: 64px;
            background: var(--primary);
            color: var(--on-primary);
            border: none; border-radius: 20px;
            font-size: 26px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 14px rgba(0,0,0,0.25);
            transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
        }

        .fab-main:active { transform: scale(0.93); }

        /* â”€â”€ Add task panel (slides up from bottom) â”€â”€ */
        .add-panel-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            z-index: 200;
            align-items: flex-end;
            justify-content: center;
        }

        .add-panel-overlay.active { display: flex; }

        .add-panel {
            background: var(--surface-c);
            border-radius: 28px 28px 0 0;
            width: 100%;
            max-width: 700px;
            padding: 0 0 12px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            animation: slideUp 0.25s cubic-bezier(0.4,0,0.2,1);
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .add-panel-handle {
            width: 32px; height: 4px;
            background: var(--outline-v);
            border-radius: 2px;
            margin: 12px auto 16px;
        }

        .add-panel-input-row {
            padding: 0 16px 14px;
        }

        .add-panel-input {
            width: 100%;
            padding: 16px 18px;
            background: var(--surface-chh);
            border: none;
            border-radius: 28px;
            color: var(--on-surface);
            font-size: 16px;
            font-family: inherit;
            outline: none;
        }

        .add-panel-input::placeholder { color: var(--outline); }

        .add-panel-input:focus {
            background: var(--primary-container);
            color: var(--on-primary-container);
        }

        .add-panel-buttons {
            display: flex;
            gap: 10px;
            padding: 0 16px;
        }

        .add-day-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 20px;
            font-size: 15px;
            font-family: inherit;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }

        .add-day-btn.today-btn {
            background: var(--primary);
            color: var(--on-primary);
        }

        .add-day-btn.tomorrow-btn {
            background: var(--surface-chh);
            color: var(--on-surface-v);
        }

        .add-day-btn:active { transform: scale(0.96); opacity: 0.85; }

        /* â”€â”€ Archive / sheet â”€â”€ */
        .sheet-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            z-index: 300;
            align-items: flex-end;
            justify-content: center;
        }

        .sheet-overlay.active { display: flex; }

        .sheet {
            background: var(--surface-c);
            border-radius: 28px 28px 0 0;
            width: 100%;
            max-width: 700px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            animation: slideUp 0.25s cubic-bezier(0.4,0,0.2,1);
        }

        .sheet-handle {
            width: 32px; height: 4px;
            background: var(--outline-v);
            border-radius: 2px;
            margin: 12px auto 0;
        }

        .sheet-header {
            padding: 14px 24px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sheet-header h2 {
            font-size: 18px;
            font-weight: 500;
        }

        .sheet-close {
            background: var(--surface-chh);
            border: none; border-radius: 20px;
            padding: 7px 14px; cursor: pointer;
            font-size: 13px; font-family: inherit;
            font-weight: 500; color: var(--on-surface-v);
            transition: all 0.15s;
        }

        .sheet-close:active { background: var(--error-c); color: var(--error); }

        .sheet-body {
            flex: 1;
            overflow-y: auto;
            padding: 8px 16px 32px;
        }

        /* â”€â”€ Backdrop (for FAB) â”€â”€ */
        #fab-backdrop {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 99;
        }

        /* â”€â”€ Media queries â”€â”€ */
        @media (max-width: 600px) {
            .container { flex-direction: column; }
            .divider { width: 100%; min-height: 24px; }
            .divider-text { left: 50%; top: 50%; transform: translate(-50%, -50%); }
            .fab-wrap { bottom: 20px; right: 20px; }
        }

        @media (min-width: 601px) {
            .container { flex-direction: row; }
            .divider { width: 24px; min-width: 24px; }
            .divider-text { left: 50%; top: 50%; transform: translate(-50%, -50%) rotate(-90deg); }
        }
    </style>
</head>
<body data-theme="dark">
    <div class="container">
        <!-- Today -->
        <div class="panel">
            <div class="header">
                <h1>today</h1>
                <div class="date" id="today-date"></div>
                <div class="progress-bar"><div class="progress-fill" id="today-progress" style="width:0%"></div></div>
                <div class="progress-text" id="today-progress-text">0 of 0 completed</div>
            </div>
            <div class="entries" id="today-entries"></div>
        </div>

        <!-- Divider -->
        <div class="divider"><div class="divider-text">it can wait</div></div>

        <!-- Tomorrow -->
        <div class="panel">
            <div class="header">
                <h1>tomorrow</h1>
                <div class="date" id="tomorrow-date"></div>
                <div class="progress-bar"><div class="progress-fill" id="tomorrow-progress" style="width:0%"></div></div>
                <div class="progress-text" id="tomorrow-progress-text">0 of 0 completed</div>
            </div>
            <div class="entries" id="tomorrow-entries"></div>
        </div>
    </div>

    <!-- FAB -->
    <div class="fab-wrap">
        <div class="fab-dial" id="fab-dial">

            <div class="fab-row">
                <div class="fab-label">light / dark</div>
                <button class="fab-mini" id="theme-btn">ðŸŒ™</button>
            </div>

            <div class="fab-row">
                <div class="fab-label">accent color</div>
                <button class="fab-mini" id="accent-swatch">
                    <input type="color" id="accent-picker" value="#006491">
                </button>
            </div>

            <div class="fab-row">
                <div class="fab-label">clear completed</div>
                <button class="fab-mini" id="fab-clear">âœ“</button>
            </div>

            <div class="fab-row">
                <div class="fab-label">archive</div>
                <button class="fab-mini" id="fab-archive">ðŸ“¦</button>
            </div>

        </div>
        <button class="fab-main" id="fab-main">ï¼‹</button>
    </div>

    <div id="fab-backdrop"></div>

    <!-- Add task panel -->
    <div class="add-panel-overlay" id="add-panel-overlay">
        <div class="add-panel">
            <div class="add-panel-handle"></div>
            <div class="add-panel-input-row">
                <input class="add-panel-input" id="task-input" type="text" placeholder="what can wait?" autocomplete="off">
            </div>
            <div class="add-panel-buttons">
                <button class="add-day-btn today-btn" id="add-today-btn">today</button>
                <button class="add-day-btn tomorrow-btn" id="add-tomorrow-btn">tomorrow</button>
            </div>
        </div>
    </div>

    <!-- Archive sheet -->
    <div class="sheet-overlay" id="archive-sheet">
        <div class="sheet">
            <div class="sheet-handle"></div>
            <div class="sheet-header">
                <h2>archive</h2>
                <button class="sheet-close" id="close-archive">close</button>
            </div>
            <div class="sheet-body" id="archive-entries"></div>
        </div>
    </div>

    <script>
        let data = { today: [], tomorrow: [], archived: [] };

        function loadData() {
            try {
                const saved = localStorage.getItem('fold-notes-data');
                if (!saved) return;
                const p = JSON.parse(saved);
                data.today = p.today || [];
                data.tomorrow = p.tomorrow || [];
                if (Array.isArray(p.archived)) {
                    data.archived = p.archived;
                } else if (p.archived) {
                    // migrate old split format
                    const t = (p.archived.today || []).map(e => ({...e, day:'today'}));
                    const m = (p.archived.tomorrow || []).map(e => ({...e, day:'tomorrow'}));
                    data.archived = [...m, ...t];
                }
            } catch(e) {}
        }

        function saveData() {
            localStorage.setItem('fold-notes-data', JSON.stringify(data));
        }

        function formatDate(d) {
            return d.toLocaleDateString('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
        }

        function formatTs(ts) {
            if (!ts) return '';
            const diff = Date.now() - ts;
            const m = Math.floor(diff / 60000);
            const h = Math.floor(diff / 3600000);
            const d = Math.floor(diff / 86400000);
            if (m < 1) return 'just now';
            if (m < 60) return `${m}m ago`;
            if (h < 24) return `${h}h ago`;
            if (d < 7) return `${d}d ago`;
            return new Date(ts).toLocaleDateString('en-US', { month:'short', day:'numeric' });
        }

        function updateDates() {
            const t = new Date(), m = new Date(t);
            m.setDate(m.getDate() + 1);
            document.getElementById('today-date').textContent = formatDate(t);
            document.getElementById('tomorrow-date').textContent = formatDate(m);
        }

        let draggedId = null, draggedDay = null;

        function makeEntry(entry, day, isArchived = false) {
            const div = document.createElement('div');
            div.className = 'entry' + (entry.completed ? ' completed' : '');
            div.dataset.id = entry.id;
            div.draggable = !isArchived;

            if (!isArchived) {
                const h = document.createElement('div');
                h.className = 'drag-handle';
                h.innerHTML = '<span></span><span></span><span></span>';
                div.appendChild(h);
            }

            const cb = document.createElement('div');
            cb.className = 'checkbox' + (entry.completed ? ' checked' : '');
            if (!isArchived) cb.onclick = () => toggle(entry.id, day);
            div.appendChild(cb);

            const content = document.createElement('div');
            content.className = 'entry-content';

            const txt = document.createElement('div');
            txt.className = 'entry-text';
            txt.textContent = entry.text;
            content.appendChild(txt);

            const ts = document.createElement('div');
            ts.className = 'timestamp';
            ts.textContent = 'created ' + formatTs(entry.createdAt) +
                (entry.completedAt ? ' Â· done ' + formatTs(entry.completedAt) : '');
            content.appendChild(ts);

            if (isArchived && entry.day) {
                const tag = document.createElement('div');
                tag.className = 'archive-tag';
                tag.textContent = 'from ' + entry.day;
                content.appendChild(tag);
            }

            div.appendChild(content);

            const actions = document.createElement('div');
            actions.className = 'entry-actions';

            if (!isArchived) {
                const swap = document.createElement('button');
                swap.className = 'btn';
                swap.textContent = day === 'today' ? 'â†’' : 'â†';
                swap.onclick = () => swapEntry(entry.id, day);
                actions.appendChild(swap);
            }

            const del = document.createElement('button');
            del.className = 'btn danger';
            del.textContent = 'Ã—';
            del.onclick = () => isArchived ? deleteArchived(entry.id) : deleteEntry(entry.id, day);
            actions.appendChild(del);

            div.appendChild(actions);

            if (!isArchived) {
                div.addEventListener('dragstart', () => {
                    draggedId = entry.id; draggedDay = day;
                    div.classList.add('dragging');
                });
                div.addEventListener('dragend', () => div.classList.remove('dragging'));
                div.addEventListener('dragover', e => e.preventDefault());
                div.addEventListener('drop', e => {
                    e.stopPropagation();
                    if (draggedId === entry.id || draggedDay !== day) return;
                    const fi = data[day].findIndex(x => x.id === draggedId);
                    const ti = data[day].findIndex(x => x.id === entry.id);
                    if (fi !== -1 && ti !== -1) {
                        const [item] = data[day].splice(fi, 1);
                        data[day].splice(ti, 0, item);
                        saveData(); render();
                    }
                });
            }

            return div;
        }

        function render() {
            ['today', 'tomorrow'].forEach(day => {
                const c = document.getElementById(day + '-entries');
                c.innerHTML = '';
                data[day].forEach(e => c.appendChild(makeEntry(e, day)));
                const total = data[day].length;
                const done = data[day].filter(e => e.completed).length;
                document.getElementById(day + '-progress').style.width =
                    total > 0 ? (done / total * 100) + '%' : '0%';
                document.getElementById(day + '-progress-text').textContent =
                    done + ' of ' + total + ' completed';
            });
        }

        function addTask(day) {
            const input = document.getElementById('task-input');
            const text = input.value.trim();
            if (!text) return;
            data[day].push({ id: Date.now(), text, completed: false, createdAt: Date.now(), completedAt: null });
            input.value = '';
            saveData(); render();
            closeAddPanel();
        }

        function toggle(id, day) {
            const e = data[day].find(x => x.id === id);
            if (e) { e.completed = !e.completed; e.completedAt = e.completed ? Date.now() : null; saveData(); render(); }
        }

        function swapEntry(id, fromDay) {
            const toDay = fromDay === 'today' ? 'tomorrow' : 'today';
            const i = data[fromDay].findIndex(x => x.id === id);
            if (i !== -1) { data[toDay].push(data[fromDay].splice(i, 1)[0]); saveData(); render(); }
        }

        function deleteEntry(id, day) {
            data[day] = data[day].filter(x => x.id !== id);
            saveData(); render();
        }

        function clearCompleted() {
            ['today', 'tomorrow'].forEach(day => {
                data[day].filter(e => e.completed).forEach(e => data.archived.unshift({...e, day}));
                data[day] = data[day].filter(e => !e.completed);
            });
            saveData(); render();
        }

        function showArchive() {
            const c = document.getElementById('archive-entries');
            c.innerHTML = '';
            if (!data.archived.length) {
                const m = document.createElement('div');
                m.style.cssText = 'text-align:center;padding:40px;color:var(--outline)';
                m.textContent = 'nothing archived yet';
                c.appendChild(m);
            } else {
                data.archived.forEach(e => c.appendChild(makeEntry(e, e.day, true)));
            }
            document.getElementById('archive-sheet').classList.add('active');
        }

        function deleteArchived(id) {
            data.archived = data.archived.filter(e => e.id !== id);
            saveData(); showArchive();
        }

        // â”€â”€ Accent color â”€â”€
        function applyAccent(hex) {
            const r = parseInt(hex.slice(1,3),16);
            const g = parseInt(hex.slice(3,5),16);
            const b = parseInt(hex.slice(5,7),16);
            const dark = document.documentElement.getAttribute('data-theme') === 'dark';
            const root = document.documentElement;
            const mix = (v, f) => Math.min(255, Math.max(0, Math.round(v * f)));
            const lift = (v, f) => Math.min(255, Math.round(255 - (255-v)*f));
            const hex3 = (r,g,b) => '#'+[r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('');

            if (dark) {
                root.style.setProperty('--primary', hex3(lift(r,.3),lift(g,.3),lift(b,.3)));
                root.style.setProperty('--on-primary', hex3(mix(r,.15),mix(g,.15),mix(b,.15)));
                root.style.setProperty('--primary-container', hex3(mix(r,.3),mix(g,.3),mix(b,.3)));
                root.style.setProperty('--on-primary-container', hex3(lift(r,.3),lift(g,.3),lift(b,.3)));
            } else {
                root.style.setProperty('--primary', hex);
                root.style.setProperty('--on-primary', '#ffffff');
                root.style.setProperty('--primary-container', hex3(lift(r,.15),lift(g,.15),lift(b,.15)));
                root.style.setProperty('--on-primary-container', hex3(mix(r,.15),mix(g,.15),mix(b,.15)));
            }
            document.getElementById('accent-swatch').style.background = hex;
            localStorage.setItem('icw-accent', hex);
        }

        // â”€â”€ FAB â”€â”€
        let fabOpen = false;

        function openFab() {
            fabOpen = true;
            document.getElementById('fab-dial').classList.add('open');
            document.getElementById('fab-main').textContent = 'Ã—';
            document.getElementById('fab-backdrop').style.display = 'block';
        }

        function closeFab() {
            fabOpen = false;
            document.getElementById('fab-dial').classList.remove('open');
            document.getElementById('fab-main').textContent = 'ï¼‹';
            document.getElementById('fab-backdrop').style.display = 'none';
        }

        // â”€â”€ Add panel â”€â”€
        function openAddPanel() {
            document.getElementById('add-panel-overlay').classList.add('active');
            setTimeout(() => document.getElementById('task-input').focus(), 300);
        }

        function closeAddPanel() {
            document.getElementById('add-panel-overlay').classList.remove('active');
        }

        // â”€â”€ Init â”€â”€
        document.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('icw-theme') || 'dark';
            document.documentElement.setAttribute('data-theme', saved);
            document.getElementById('theme-btn').textContent = saved === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';

            const savedAccent = localStorage.getItem('icw-accent');
            if (savedAccent) {
                applyAccent(savedAccent);
                document.getElementById('accent-picker').value = savedAccent;
            } else {
                document.getElementById('accent-swatch').style.background = '#006491';
            }

            loadData(); updateDates(); render();

            // FAB toggle â€” tap + opens add panel, when dial is open + closes it
            document.getElementById('fab-main').addEventListener('click', () => {
                if (fabOpen) { closeFab(); } else { openAddPanel(); }
            });

            // Long-press FAB to open dial
            let fabTimer;
            document.getElementById('fab-main').addEventListener('pointerdown', () => {
                fabTimer = setTimeout(() => { openFab(); }, 400);
            });
            document.getElementById('fab-main').addEventListener('pointerup', () => clearTimeout(fabTimer));
            document.getElementById('fab-main').addEventListener('pointercancel', () => clearTimeout(fabTimer));

            document.getElementById('fab-backdrop').addEventListener('click', closeFab);

            document.getElementById('theme-btn').addEventListener('click', () => {
                const cur = document.documentElement.getAttribute('data-theme');
                const next = cur === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', next);
                localStorage.setItem('icw-theme', next);
                document.getElementById('theme-btn').textContent = next === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
                const a = localStorage.getItem('icw-accent');
                if (a) applyAccent(a);
                closeFab();
            });

            document.getElementById('accent-picker').addEventListener('input', e => applyAccent(e.target.value));

            document.getElementById('fab-clear').addEventListener('click', () => { clearCompleted(); closeFab(); });
            document.getElementById('fab-archive').addEventListener('click', () => { closeFab(); showArchive(); });

            document.getElementById('add-today-btn').addEventListener('click', () => addTask('today'));
            document.getElementById('add-tomorrow-btn').addEventListener('click', () => addTask('tomorrow'));

            document.getElementById('add-panel-overlay').addEventListener('click', e => {
                if (e.target.id === 'add-panel-overlay') closeAddPanel();
            });

            // Allow Enter key to quick-add to today
            document.getElementById('task-input').addEventListener('keydown', e => {
                if (e.key === 'Enter') addTask('today');
            });

            document.getElementById('close-archive').addEventListener('click', () =>
                document.getElementById('archive-sheet').classList.remove('active'));
            document.getElementById('archive-sheet').addEventListener('click', e => {
                if (e.target.id === 'archive-sheet')
                    document.getElementById('archive-sheet').classList.remove('active');
            });

            setInterval(() => {
                const n = new Date();
                if (n.getHours() === 0 && n.getMinutes() === 0) updateDates();
            }, 60000);
        });

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/it-can-wait/sw.js', { scope: '/it-can-wait/' });
        }
    </script>
</body>
</html>
